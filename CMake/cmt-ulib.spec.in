Summary: Cosmic Muon Tomography core libraries
Name: cmt-ulib
Version: @PKGVERSION@
Release: @PKGRELEASE@%{?dist}
License: EUROPEAN UNION PUBLIC LICENCE v. 1.2
Vendor: INFN
URL: https://github.com/OpenCMT/uLib
Group: Development/Libraries
BuildArch: %{_arch}
%if %{?rhel}%{!?rhel:0} >= 8
BuildRequires: cmake
%else
BuildRequires: cmake3
%endif
BuildRequires: doxygen
BuildRequires: boost-devel
BuildRequires: eigen3-devel
BuildRequires: vtk-devel
BuildRequires: readline-devel
BuildRequires: pcl-devel
BuildRequires: root-geom
BuildRequires: root-genvector
BuildRequires: root-smatrix
BuildRequires: root-montecarlo-eg
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
AutoReqProv: yes
Source: %{name}-%{version}.tar.gz

%description
This package contains the base toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%global _ulibpkgname mutom
%global _ulibcmakedir %{_libdir}/cmake/%{_ulibpkgname}

%prep
%setup -c
rm -rf %{buildroot}
mkdir -p %{buildroot}

%build
mkdir %{_builddir}/%{name}-%{version}/build
cd %{_builddir}/%{name}-%{version}/build
%cmake -DCMAKE_INSTALL_PREFIX=%{buildroot}%{_prefix} \
       -DCMAKE_BUILD_TYPE=RelWithDebInfo \
       -DPACKAGE_NAME=%{_ulibpkgname} \
       -DPACKAGE_INSTALL_LIB_DIR=%{buildroot}%{_libdir} \
       -DPACKAGE_INSTALL_INC_DIR=%{buildroot}%{_includedir}/%{_ulibpkgname} \
       -DPACKAGE_INSTALL_CMAKE_DIR=%{buildroot}%{_ulibcmakedir} \
       -DNODOXYGEN=ON \
       %{_builddir}/%{name}-%{version}
make %{?_smp_mflags}

%install
cd %{_builddir}/%{name}-%{version}/build
make install
sed -i 's|%{buildroot}/usr|%{_prefix}|g' %{buildroot}%{_ulibcmakedir}/uLibTargets.cmake
sed -i 's|%{buildroot}/usr|%{_prefix}|g' %{buildroot}%{_ulibcmakedir}/uLibTargets-relwithdebinfo.cmake

%clean
rm -rf %{buildroot}

%files
%defattr(-,root,root)
%{_libdir}/libmutom*.so.0.2
%{_libdir}/uLibRootDict_rdict.pcm

%package devel
Summary: Cosmic Muon Tomography core libraries, development files
Requires: %{name}
Requires: boost-devel
Requires: eigen3-devel
Requires: vtk-devel
Requires: readline-devel
Requires: pcl-devel
Requires: root-geom
Requires: root-genvector
Requires: root-smatrix
Requires: root-montecarlo-eg


%description devel
This package contains the base toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%files devel
%defattr(-,root,root)
%dir %{_ulibcmakedir}
/usr/bin/uLib_config
%{_libdir}/libmutom*.so
%{_ulibcmakedir}/*.cmake
%dir %{_includedir}/%{_ulibpkgname}
%dir %{_includedir}/%{_ulibpkgname}/Core
%dir %{_includedir}/%{_ulibpkgname}/Math
%dir %{_includedir}/%{_ulibpkgname}/Root
%dir %{_includedir}/%{_ulibpkgname}/Detectors
%dir %{_includedir}/%{_ulibpkgname}/Vtk
%{_includedir}/%{_ulibpkgname}/*.h
%{_includedir}/%{_ulibpkgname}/Core/*.h
%{_includedir}/%{_ulibpkgname}/Math/*.h
%{_includedir}/%{_ulibpkgname}/Math/*.hpp
%{_includedir}/%{_ulibpkgname}/Root/*.h
%{_includedir}/%{_ulibpkgname}/Detectors/*.h
%{_includedir}/%{_ulibpkgname}/Vtk/*.h








%changelog
* Tue Dec 04 2018 Paolo Andreetto <paolo.andreetto@pd.infn.it> - 0.2.1-1
- Repackaging for CentOS 7

