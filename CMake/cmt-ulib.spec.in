Summary: Cosmic Muon Tomography core libraries
Name: cmt-ulib
Version: @PKGVERSION@
Release: @PKGRELEASE@%{?dist}
License: EUROPEAN UNION PUBLIC LICENCE v. 1.2
Vendor: INFN
URL: https://github.com/OpenCMT/uLib
Group: Development/Libraries
BuildArch: %{_arch}
%if %{?rhel}%{!?rhel:0} >= 8
BuildRequires: cmake
%else
BuildRequires: cmake3
%endif
BuildRequires: boost-devel
BuildRequires: eigen3-devel
BuildRequires: vtk-devel
BuildRequires: readline-devel
BuildRequires: pcl-devel
BuildRequires: root-geom
BuildRequires: root-genvector
BuildRequires: root-smatrix
BuildRequires: root-montecarlo-eg
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
AutoReqProv: yes
Source: %{name}-%{version}.tar.gz

%description
This package contains the base toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%prep
%setup -c
rm -rf %{buildroot}
mkdir -p %{buildroot}

%build
mkdir %{_builddir}/%{name}-%{version}/build
cd %{_builddir}/%{name}-%{version}/build
%cmake -DCMAKE_INSTALL_PREFIX=%{buildroot}/usr \
       -DCMAKE_BUILD_TYPE=RelWithDebInfo \
       -DPACKAGE_INSTALL_LIB_DIR=%{buildroot}/usr/lib64 \
       -DNODOXYGEN=ON \
       %{_builddir}/%{name}-%{version}
make %{?_smp_mflags}

%install
cd %{_builddir}/%{name}-%{version}/build
make install
# workaround 1
mv %{buildroot}/usr/lib/* %{buildroot}/usr/lib64
rm -rf %{buildroot}/usr/lib
# workaround 2
sed -i 's|%{buildroot}/usr|/usr|g' %{buildroot}/usr/lib64/cmake/mutom-%{version}/uLibTargets.cmake
sed -i 's|%{buildroot}/usr|/usr|g' %{buildroot}/usr/lib64/cmake/mutom-%{version}/uLibTargets-relwithdebinfo.cmake

%clean
rm -rf %{buildroot}

%files
%defattr(-,root,root)
/usr/lib64/libmutom*.so.0.2
/usr/lib64/uLibRootDict_rdict.pcm

%package devel
Summary: Cosmic Muon Tomography core libraries, development files
Requires: %{name}
Requires: boost-devel
Requires: eigen3-devel
Requires: vtk-devel
Requires: readline-devel
Requires: pcl-devel
Requires: root-geom
Requires: root-genvector
Requires: root-smatrix
Requires: root-montecarlo-eg


%description devel
This package contains the base toolkit library for Cosmic Muon Tomography reconstruction,
analysis and imaging software Developed by University of Padova and INFN Sezione di Padova  Italy

%files devel
%defattr(-,root,root)
%dir /usr/lib64/cmake/mutom-0.2
/usr/bin/uLib_config
/usr/lib64/libmutom*.so
/usr/lib64/cmake/mutom-0.2/*.cmake
%dir /usr/include/mutom-0.2
%dir /usr/include/mutom-0.2/Core
%dir /usr/include/mutom-0.2/Math
%dir /usr/include/mutom-0.2/Root
%dir /usr/include/mutom-0.2/Detectors
%dir /usr/include/mutom-0.2/Vtk
/usr/include/mutom-0.2/*.h
/usr/include/mutom-0.2/Core/*.h
/usr/include/mutom-0.2/Math/*.h
/usr/include/mutom-0.2/Math/*.hpp
/usr/include/mutom-0.2/Root/*.h
/usr/include/mutom-0.2/Detectors/*.h
/usr/include/mutom-0.2/Vtk/*.h








%changelog
* Tue Dec 04 2018 Paolo Andreetto <paolo.andreetto@pd.infn.it> - 0.2.1-1
- Repackaging for CentOS 7

